**203.3 Creating and configuring filesystem options**

**Weight:** 2

**Description: **Candidates should be able to configure automount filesystems using AutoFS. This objective includes configuring automount for network and device filesystems. Also included is creating filesystems for devices such as CD-ROMs and a basic feature knowledge of encrypted filesystems.

**Key Knowledge Areas:**

* autofs configuration files
* Understanding of automount units
* UDF and ISO9660 tools and utilities
* Awareness of other CD-ROM filesystems \(HFS\)
* Awareness of CD-ROM filesystem extensions \(Joliet, Rock Ridge, El Torito\)
* Basic feature knowledge of data encryption \(dm-crypt / LUKS\)

**Terms and Utilities:**

* /etc/auto.master
* /etc/auto.\[dir\]
* mkisofs
* cryptsetup

#### autofs

We have already worked with fstab and its usage. When we mount a device using fstab it is always mounted and ready.It is okey except when we are using nfs, cifs, smb , ... trough the network. autofs idea is mount when you need. that is all! this way we avoid network over head .

```
root@server1:~# apt install autofs
```

autofs puts its configuration files in /etc directory :

```
root@server1:~# ls -l /etc/auto*
-rw-r--r-- 1 root root 12596 Jun 22  2017 /etc/autofs.conf
-rw-r--r-- 1 root root   797 Jun 22  2017 /etc/auto.master
-rw-r--r-- 1 root root   524 Jun 22  2017 /etc/auto.misc
-rwxr-xr-x 1 root root  1039 Jun 22  2017 /etc/auto.net
-rwxr-xr-x 1 root root  2191 Jun 22  2017 /etc/auto.smb
```

#### auto.master

auto.master is autofs main configuration and it is  first configuration file autofs checks. Inside autofs.master we mention where we want the mount-point to be and where is related configuration file. It is strange but that is the way autofs works. So beside auto.master file , you might need other auto.\[\*\] configuration files which auto.master refers to, to create and mount.The format of master map is:

```
mount-point map-name options
```

![](/assets/autofs.jpg)

and the result would be /mynfs/dir1 . Lets make our hands dirty and see what is inside auto.master:

```
#
# Sample auto.master file
# This is a 'master' automounter map and it has the following format:
# mount-point [map-type[,format]:]map [options]
# For details of the format look at auto.master(5).
#
#/misc    /etc/auto.misc
#
# NOTE: mounts done from a hosts map will be mounted with the
#    "nosuid" and "nodev" options unless the "suid" and "dev"
#    options are explicitly given.
#
#/net    -hosts
#
# Include /etc/auto.master.d/*.autofs
# The included files must conform to the format of this file.
#
+dir:/etc/auto.master.d
#
# Include central master map if it can be found using
# nsswitch sources.
#
# Note that if there are entries for /net or /misc (as
# above) in the included master map any keys that are the
# same will not be seen as the first read key seen takes
# precedence.
#
+auto.master

# Added by Me and You :)
/root/mynfs    /etc/auto.nfs
```

so mynfs directory would be created and would be used as mount point, then it refers to /etc/auto.nfs configuration file.We can use `--timeout=60` to define mount timeout in seconds.

#### auto.nfs

`vi /etc/auto.nfs`

```
dir1    192.168.10.150:/root/nfsshared/mydir1
```

and then restart autofs service in order to changes take effect:

```
root@server1:~# systemctl restart autofs  
root@server1:~# ls
mynfs
root@server1:~# ls mynfs/
root@server1:~# mount | grep mynfs
/etc/auto.nfs on /root/mynfs type autofs (rw,relatime,fd=6,pgrp=1738,timeout=300,minproto=5,maxproto=5,indirect,pipe_ino=25202)

root@server1:~# ls mynfs/dir1
myfile1  myfile2  myfile3

root@server1:~# mount | grep mynfs
/etc/auto.nfs on /root/mynfs type autofs (rw,relatime,fd=6,pgrp=1738,timeout=300,minproto=5,maxproto=5,indirect,pipe_ino=25202)
192.168.10.150:/root/nfsshared/mydir1 on /root/mynfs/dir1 type nfs4 (rw,relatime,vers=4.0,rsize=131072,wsize=131072,namlen=255,hard,proto=tcp,port=0,timeo=600,retrans=2,sec=sys,clientaddr=192.168.10.149,local_lock=none,addr=192.168.10.150)
```

Also `watch mount` command  is usefull to observe what is going.

### CDROM File Systems





