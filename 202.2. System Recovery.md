### **202.2 System Recovery**

**Weight:** 4

**Description:** Candidates should be able to properly manipulate a Linux system during both the boot process and during recovery mode. This objective includes using both the init utility and init-related kernel options. Candidates should be able to determine the cause of errors in loading and usage of bootloaders. GRUB version 2 and GRUB Legacy are the bootloaders of interest. Both BIOS and UEFI systems are covered.

**Key Knowledge Areas:**

* BIOS and UEFI
* NVMe booting
* GRUB version 2 and Legacy
* grub shell
* boot loader start and hand off to kernel
* kernel loading
* hardware initialisation and setup
* daemon/service initialisation and setup
* Know the different boot loader install locations on a hard disk or removable device.
* Overwrite standard boot loader options and using boot loader shells.
* Use systemd rescue and emergency modes.

**Terms and Utilities:**

* mount
* fsck
* inittab, telinit and init with SysV init
* The contents of /boot/, /boot/grub/ and /boot/efi/
* EFI System Partition \(ESP\)
* GRUB
* grub-install
* efibootmgr
* UEFI shell
* initrd, initramfs
* Master boot record
* systemctl



#### Boot process overview

lets take a look at boot process and stick what ever we have learned till now:

```
BIOS / UEFI
    |
    Bootable Disk
        |
        Boot Loader(LILO,Grub,Grub2)
            |
            Kernel (initramfs/initd)
                |
                init --->systemd / upstart / SysV
                            |
                            everything---shell & other services and programs
```

if any problems occur on any of these steps, boot process fails. It might be motherboard  problems, Disk problems or boot loader problem.

### Boot Loader Recovery General Notes

Recovering boot loader needs to specify three major required elements. We have already got familiar with all 3:

1. root partion
2. kernel and boot partition as its argument \(usually same as root\)
3. initrd/initramfs 

how ever some commands are different in grub version 1 and version 2.

* #### Recovering Grub Legacy

grub version1 dosn't have "ls" command.Also it starts counting hard disk partitions from "Zero" 

```
grub>help ###to see grub v1 commands

###1.root,What the root is ?
grub>root ### if nothing showed up, we have to boot system by using another media

###2.Kernel, which kernel we want to boot from? nad where is the boot partition? consider lvm :(
grub> kernel /vmlinuz.x.y.z root=/dev/sdaX

###3.initramfs, Which initramfs is going to be loaded? It should be the same as kernel version
grub>initrd /initrd-x.y.z 

### and finally boot the system
grub>boot
```

after rebooting system install grub again:

    [root@localhost ~]# grub-install /dev/sda
    Installation finished. No error reported.
    This is the contents of the device map /boot/grub/device.map.
    Check if this is correct or not. If any of the lines is incorrect,
    fix it and re-run the script `grub-install'.

    # this device map was generated by anaconda
    (hd0)     /dev/sda

* #### Recovering Grub2

```

```



